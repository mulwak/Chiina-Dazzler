# Chiina-Dazzler
6502 Graphics Board on CPLD

http://ponzu840w.starfree.jp/blog/blog.html?id=00030

# 仕様
- MachXO2にプログラミング
- 256\*192 (DS画面サイズ) を1024\*768 (XGA) に引き延ばして表示
- RGB121、固定16色
- 16色モード/2色モード
- フレームバッファ4枚 (1MbitRAMをVRAMとして接続)
- 6502CPUバスに直接インタフェース (R/Wを除く)
- 自由なタイミングでVRAMに書き込み

# 使い方
これから書く

# データシート
## レジスタ選択
3つのレジスタ選択ラインは通常、プロセッサが様々なCRTC内部レジスタを選択できるようにプロセッサアドレスラインに接続されています。表1に、内部レジスタ選択のコーディングを示します。

表1. 内部レジスタ

|RS2|RS1|RS0|レジスタ操作<br>RWB=ロー|
|:-:|:-:|:-:|:-------------------:|
|0|0|1|コンフィグレジスタ書き込み|
|0|1|0|VRAM水平アドレスレジスタ書き込み|
|0|1|1|VRAM垂直アドレスレジスタ書き込み|
|1|0|0|VRAM書き込みデータ書き込み|
|1|0|1|出力フレーム選択レジスタ書き込み|
|1|1|0|書き込みフレーム選択レジスタ書き込み|
|1|1|1|2色パレット選択レジスタ書き込み|

**NOTE**:RWB=ハイのとき、レジスタ読み取りは無効です。

### コンフィグレジスタ($1)
コンフィグレジスタは、各フレームの色モードと、VRAMデータ書き込み時の書き込みアドレスカウントアップの有無を設定します。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|MD0|MD1|MD2|MD3|-|-|WCMD|WCUE|

+ 色モード選択 (MD0~MD3)
	+ このビットが0のとき該当するフレームは16色モードとして表示され、1のときは2色モードとして表示されます。
+ 書き込み色モード (WCMD)
	+ このビットが0のとき、VRAM水平/垂直アドレスレジスタへの書き込みは16色モードにおける水平座標と垂直座標に一致するように書き込みカーソルレジスタが設定されます。このビットが1のとき、VRAM水平/垂直アドレスレジスタへの書き込みは2色モードにおける水平座標と垂直座標に一致するように書き込みカーソルレジスタが設定されます。
+ 書き込みカウントアップイネーブル (WCUE)
	+ このビットが1のとき、VRAM書き込み時にVRAM書き込みカーソルレジスタに1が加算されます。VRAM水平アドレスレジスタがオーバーフローした場合、VRAM垂直アドレスレジスタに1が加算されます。このビットが0のときはなにもしません。

### VRAM水平アドレスレジスタ ($2)

VRAM水平アドレスレジスタへの書き込みは、VRAM書き込みカーソルレジスタの水平座標を決定するビット列として反映されます。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|-|VMAH6|VMAH5|VMAH4|VMAH3|VMAH2|VMAH1|VMAH0|

+ VRAM水平アドレスレジスタ (VMAH0~VMAH6)
	+ コンフィグレジスタのWCMDビットが0のとき、書き込まれた7ビットの値は、VRAM書き込みカーソルレジスタの16色モードにおける水平座標を決定する下位7ビットとして反映されます。WCMDビットが1のときは、VMAH4以下の5ビットの値が、VRAM書き込みカーソルレジスタの2色モードにおける水平座標を決定する下位5ビットとして反映されます。このときVMAH6とVMAH5は無視されます。

### VRAM垂直アドレスレジスタ ($3)
VRAM垂直アドレスレジスタへの書き込みは、VRAM書き込みカーソルレジスタの16色モードにおける垂直座標を決定する8ビットとして反映されます。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|VMAV7|VMAV6|VMAV5|VMAV4|VMAV3|VMAV2|VMAV1|VMAV0|

+ VRAM水平アドレスレジスタ (VMAV0~VMAV7)
	+ コンフィグレジスタのWCMDビットが0のとき、書き込まれた8ビットの値は、VRAM書き込みカーソルレジスタの16色モードにおける垂直座標を決定する8ビットとして反映されます。WCMDビットが1のときは、書き込まれた8ビットの値が、VRAM書き込みカーソルレジスタの2色モードにおける垂直座標を決定する8ビットとして反映されます。

### VRAM書き込みデータレジスタ ($4)
VRAM書き込みデータレジスタへの書き込みは、VRAMへのデータ書き込みのためにバッファリングされます。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|WDBF7|WDBF6|WDBF5|WDBF4|WDBF3|WDBF2|WDBF1|WDBF0|

+ VRAM書き込みデータ (WDBF0~WDBF7)
	+ 書き込まれた1バイトのデータは、次のVRAM書き込みサイクルにおいてVRAMのVRAM書きこみカーソルレジスタの示すアドレスに書き込まれます。

### 出力フレーム選択レジスタ ($5)
出力フレーム選択レジスタは、4分割されたピクセル行内の各行がフレーム0からフレーム3のどのフレームを反映するかを決定します。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|RF0-1|RF0-0|RF1-1|RF1-0|RF2-1|RF2-0|RF3-1|RF3-0|

+ ピクセル内0行目出力フレーム選択レジスタ (RF0-1~RF0-0)
	+ 4分割されたピクセル内行の最上行がフレーム0からフレーム3のどのフレームを出力するかを決定します。


### 書き込みフレーム選択レジスタ ($6)
書き込みフレーム選択レジスタは、書き込みデータレジスタへの書き込みがVRAM上のどのフレームに対して行われるかを決定します。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|-|-|-|-|-|-|WF1|WF0|

+ 書き込みフレーム選択レジスタ (WF1, WF0)
	+ VRAM書き込みを行うフレームを決定します。

### 2色パレット選択レジスタ ($7)
2色モードにおけるデータビットの意味する色を選択します。

|7|6|5|4|3|2|1|0|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|TCP0-3|TCP0-2|TCP0-1|TCP0-0|TCP1-3|TCP1-2|TCP0-1-1|TCP1-0|

+ 2色パレット0選択レジスタ(TCP0-3~TCP0-0)
	+ データビット’0’の意味する色を4ビット16色パレットの中から選択します。

+ 2色パレット1選択レジスタ(TCP1-3~TCP1-0)
	+ データビット’1’の意味する色を4ビット16色パレットの中から選択します。

## 4ビット16色パレット
16色モードにおけるデータバイトの上位または下位ニブル、2色モードにおける2色パレット選択レジスタの上位または下位ニブルの意味する色は、下記の4ビット16色パレットによる。

略

